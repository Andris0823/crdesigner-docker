[supervisord]
# Run in the foreground, required for Docker
nodaemon=true
# Send supervisor's own logs to stdout for 'docker logs'
logfile=/dev/stdout
logfile_maxbytes=0

# --- 1. TIGERVNC SERVER (Creates the display and VNC server) ---
[program:tigervnc]
# This single command creates display :1 AND starts a VNC server on port 5900.
#Geometry: Resolution.
command=/usr/bin/Xvnc :1 -geometry 1920x1080 -depth 24 -rfbport 5900 -SecurityTypes None
priority=10
autorestart=true
startsecs=2
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0

# --- 2. WINDOW MANAGER (Adds title bars and movability) ---
# THIS IS THE FIX: We are adding openbox back in.
[program:openbox]
# Starts the window manager on the display created by TigerVNC.
command=/usr/bin/openbox-session
priority=20
autorestart=true
startsecs=1
environment=DISPLAY=":1"
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0

# --- 3. WEB PROXY ---
[program:novnc]
# This connects to the TigerVNC server.
command=/usr/bin/websockify --web=/usr/share/novnc/ 6080 127.0.0.1:5900
priority=30
autorestart=true
startsecs=2
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0

# --- 4. THE APPLICATION ---
[program:crdesigner]
# This starts the GUI, which will now be managed by openbox.
command=/app/start-gui.sh
priority=40
autorestart=true
startsecs=5
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
